# Smoke Belcher Module - Development Guide for AI Agent

## üéØ Overview

This document outlines the requirements and structure for the **Smoke Belcher Module**. The primary goal is to create a user-friendly interface for managing smoke belching violations, records, payments, and reports. The target users are non-technical personnel accustomed to older systems, so simplicity, clarity, and ease of navigation are paramount in UI/UX design.

## üõ†Ô∏è Technology Stack

- **Frontend (Client):** React
- **Backend (Server):** Apollo Server (GraphQL)

## üìÇ Project Structure

Please adhere to the following directory structure for new components, hooks, and server-side logic:

- **React Client Components:**
  - `client/src/presentation/roles/belching/`: Main components for specific features of the Smoke Belcher module (e.g., `FeeControl.tsx`, `SmokeBelcherMenu.tsx`).
  - Reusable UI elements or very specific belching-related presentational components can also reside here in subdirectories if needed.
- **React Client Libraries/Utilities:**
  - `client/src/lib/`: For utility functions, API client configurations (e.g., Apollo Clien), constants, or helper functions relevant to the belching module or shared across it.
- **React Client Custom Hooks:**
  - `client/src/hook/`: For custom React hooks that encapsulate logic related to the Smoke Belcher module (e.g., `useFeeManagement.ts`, `useVehicleSearch.ts`).
- **Apollo Server Backend:**
  - `server/src/`: GraphQL schema definitions (`*.ts`), resolvers (`*.resolvers.ts`), data sources/services (`*.ts`), and database models/interactions related to the belching module. Consider subdirectories like `server/src/modules/belching/` for better organization.

## ‚ú® Core Features

The Smoke Belcher Module is divided into the following core functionalities:

1.  **Fee Control:** Management of fees, rates, and their effective dates.
2.  **Smoke Belcher Menu:** Central hub for managing vehicle records, violations, and history.
3.  **Driver Query:** Search and display driver-specific information and offenses.
4.  **Order of Payment:** Generation and management of payment orders for individual violations.
5.  **Garage Testing:** Management of group/garage testing requests and results.
6.  **Garage Testing Order of Payment:** Generation of batch payment orders for garage testing.
7.  **Reports:** Generation of various summary and detailed reports.

---

## üìù AI Development Checklist & Progress Tracker

**Instructions for AI Agent:**

- Please review each feature and its sub-tasks.
- As you complete the implementation for each item, mark it as done (`[x]`).
- In the "AI Progress Notes (File Locations, Key Components/Functions, etc.)" column, provide:
  - Key file paths for UI components (e.g., `client/src/presentation/roles/belching/FeeTable.tsx`).
  - Key file paths for hooks (e.g., `client/src/hook/useFeeData.ts`).
  - Relevant GraphQL schema types, queries, or mutations (e.g., `type Fee`, `Query.fees`, `Mutation.createFee`).
  - Key server-side resolver/service files (e.g., `server/src/modules/belching/fee.resolvers.ts`).

| Feature Group             | Task                                                                                                                                                                   | Status | AI Progress Notes (File Locations, Key Components/Functions, etc.)                                                                                                                                       |
| :------------------------ | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **1. Fee Control**        |                                                                                                                                                                        |        |                                                                                                                                                                                                          |
|                           | Fees Table UI (display: fee_id, rate, date effective, offense level, category)                                                                                         | `[x]`  | UI: `client/src/presentation/roles/belching/components/fee/FeeTable.tsx`, Page: `client/src/presentation/roles/belching/pages/FeeControl.tsx`                                                            |
|                           | Implement "New Rate" functionality (form, API call)                                                                                                                    | `[x]`  | UI: `FeeTable.tsx` (form, add), API: `client/src/lib/api/belching-api.ts` (`createBelchingFee`)                                                                                                          |
|                           | Implement "Edit Rate" functionality (form, API call)                                                                                                                   | `[x]`  | UI: `FeeTable.tsx` (form, edit), API: `client/src/lib/api/belching-api.ts` (`updateBelchingFee`)                                                                                                         |
|                           | Implement "Delete Rate" functionality (confirmation, API call)                                                                                                         | `[x]`  | UI: `FeeTable.tsx` (delete dialog), API: `client/src/lib/api/belching-api.ts` (`deleteBelchingFee`)                                                                                                      |
|                           | Backend: Schema, Resolvers, Services for Fee CRUD                                                                                                                      | `[x]`  | Schema: `server/src/modules/belching/schema.ts`, Resolvers: `server/src/modules/belching/resolvers.ts`, Repo: `server/src/modules/belching/repository.ts`, Types: `server/src/modules/belching/types.ts` |
| **2. Smoke Belcher Menu** |                                                                                                                                                                        |        |                                                                                                                                                                                                          |
|                           | Select Record from Table UI (display: plate no, type, operator)                                                                                                        | `[x]`  | UI: `client/src/presentation/roles/belching/components/SmokeBelcherMenu.tsx`                                                                                                                             |
|                           | Add New Record functionality (form, API call)                                                                                                                          | `[x]`  | UI: `SmokeBelcherMenu.tsx` (form, modal, logic), Backend: `client/src/lib/api/belching-api.ts`, `server/src/modules/belching/`                                                                           |
|                           | Update Record functionality (form, API call)                                                                                                                           | `[x]`  | UI: `SmokeBelcherMenu.tsx` (form, modal, logic), Backend: `client/src/lib/api/belching-api.ts`, `server/src/modules/belching/`                                                                           |
|                           | Delete Record functionality (confirmation, API call)                                                                                                                   | `[x]`  | UI: `SmokeBelcherMenu.tsx` (delete dialog), Backend: `client/src/lib/api/belching-api.ts`, `server/src/modules/belching/`                                                                                |
|                           | Show Information display section (plate number, vehicle type, transport group, operator/company, operator address, owner name, motor no, MV no, status, license valid) | `[x]`  | UI: `client/src/presentation/roles/belching/components/smokeBelcher/RecordInfo.tsx`                                                                                                                      |
|                           | Violations Record display section (operator offense level, last data apprehended, operator offense, date of apprehension, place, driver name, driver offense, paid)    | `[x]`  | UI: `client/src/presentation/roles/belching/components/smokeBelcher/Violations.tsx`                                                                                                                      |
|                           | Encode Validation UI & Logic: [select driver] (Vehicle Info: plate, operator, current offense, date last apprehended. Violation Info: oir no, sdtr no, place, date)    | `[x]`  | UI: `client/src/presentation/roles/belching/components/smokeBelcher/EncodeValidation.tsx`, API: `client/src/lib/api/belching-api.ts`, logic in `SmokeBelcherMenu.tsx`                                    |
|                           | Record History display section (type, date, details, OR no, status)                                                                                                    | `[x]`  | UI: `client/src/presentation/roles/belching/components/smokeBelcher/RecordHistory.tsx`                                                                                                                   |
|                           | Backend: Schema, Resolvers, Services for Smoke Belcher Records CRUD & related info                                                                                     | `[~]`  | Planned: `server/src/modules/belching/schema.ts`, `resolvers.ts`, `repository.ts`, `types.ts` (to be extended for records)                                                                               |
| **3. Driver Query**       |                                                                                                                                                                        |        |                                                                                                                                                                                                          |
|                           | Input fields for search (driver name, plate no, OR no, transport group)                                                                                                | `[x]`  | UI: `client/src/presentation/roles/belching/components/driver/DriverQuery.tsx`, API: `client/src/lib/api/driver-api.ts`                                                                                  |
|                           | Search results table UI                                                                                                                                                | `[x]`  | UI: `client/src/presentation/roles/belching/components/driver/DriverQuery.tsx`, API: `client/src/lib/api/driver-api.ts`                                                                                  |
|                           | Display Record Information section                                                                                                                                     | `[x]`  | UI: `client/src/presentation/roles/belching/components/driver/DriverQuery.tsx`, API: `client/src/lib/api/driver-api.ts`                                                                                  |
|                           | Display Offense Table for selected driver/record                                                                                                                       | `[x]`  | UI: `client/src/presentation/roles/belching/components/driver/DriverQuery.tsx`, API: `client/src/lib/api/driver-api.ts`                                                                                  |
|                           | "Print Driver Offense" functionality (PDF generation)                                                                                                                  | `[x]`  | UI: `client/src/presentation/roles/belching/components/driver/DriverQuery.tsx` (using jsPDF), error/loading states handled                                                                               |
|                           | Backend: Schema, Resolvers, Services for Driver Query & Offense retrieval                                                                                              | `[x]`  | Schema: `server/src/modules/driver/schema.ts`, Resolvers: `server/src/modules/driver/resolvers.ts`, Repo: `server/src/modules/driver/repository.ts`, Types: `server/src/modules/driver/types.ts`         |
| **4. Order of Payment**   |                                                                                                                                                                        |        |                                                                                                                                                                                                          |
|                           | Request Information section (Status, Plate Number, OOP Control No.)                                                                                                    | `[ ]`  |                                                                                                                                                                                                          |
|                           | Testing Information section (Testing Officer, Test Results, Date of Testing)                                                                                           | `[ ]`  |                                                                                                                                                                                                          |
|                           | Payment Checklists & Input (Apprehension Fee, Voluntary Fee, Impound Fee)                                                                                              | `[ ]`  |                                                                                                                                                                                                          |
|                           | Payment Checklists & Input (Driver Amount, Operator Amount)                                                                                                            | `[ ]`  |                                                                                                                                                                                                          |
|                           | "Compute Amount" button & display (Total Undiscounted, Grand Total, Date of Payments)                                                                                  | `[ ]`  |                                                                                                                                                                                                          |
|                           | "Cancel Order of Payment" button functionality                                                                                                                         | `[ ]`  |                                                                                                                                                                                                          |
|                           | "Save Order of Payment" button functionality (API call)                                                                                                                | `[ ]`  |                                                                                                                                                                                                          |
|                           | Backend: Schema, Resolvers, Services for Order of Payment creation/management                                                                                          | `[ ]`  |                                                                                                                                                                                                          |
| **5. Garage Testing**     |                                                                                                                                                                        |        |                                                                                                                                                                                                          |
|                           | View selection by Date Created                                                                                                                                         | `[ ]`  |                                                                                                                                                                                                          |
|                           | Table UI (ctrl no, requestor, date tested, no of vehicle, voluntary, renewal, status, date created, admin, payment, amount, date paid)                                 | `[ ]`  |                                                                                                                                                                                                          |
|                           | "Print Summary" functionality                                                                                                                                          | `[ ]`  |                                                                                                                                                                                                          |
|                           | "New Garage Test" functionality (form, API call)                                                                                                                       | `[ ]`  |                                                                                                                                                                                                          |
|                           | "Edit Garage Test" functionality (form, API call)                                                                                                                      | `[ ]`  |                                                                                                                                                                                                          |
|                           | "Delete Garage Test" functionality (confirmation, API call)                                                                                                            | `[ ]`  |                                                                                                                                                                                                          |
|                           | "Print CEC" (Certificate of Emission Compliance) functionality                                                                                                         | `[ ]`  |                                                                                                                                                                                                          |
|                           | "Print Batch Order of Payment" functionality                                                                                                                           | `[ ]`  |                                                                                                                                                                                                          |
|                           | Backend: Schema, Resolvers, Services for Garage Testing CRUD                                                                                                           | `[ ]`  |                                                                                                                                                                                                          |
| **6. Garage Testing OOP** |                                                                                                                                                                        |        |                                                                                                                                                                                                          |
|                           | Input fields (Enter Vehicle Name, Enter Transport Group)                                                                                                               | `[ ]`  |                                                                                                                                                                                                          |
|                           | Search Table UI (plate no, transport group, operator, offense, Add Button)                                                                                             | `[ ]`  |                                                                                                                                                                                                          |
|                           | Order of Payment Information section (Operator/Payor Name, Testing Officer, Testing Date)                                                                              | `[ ]`  |                                                                                                                                                                                                          |
|                           | Order Table UI (plate no, payment, or no, test result, pass/fail, Remove Button)                                                                                       | `[ ]`  |                                                                                                                                                                                                          |
|                           | Totals display (Total Voluntary, Total Renewal, Total Passed, Total Failed, Total No of Vehicles, Pay Amount)                                                          | `[ ]`  |                                                                                                                                                                                                          |
|                           | Backend: Schema, Resolvers, Services for Garage Testing OOP generation                                                                                                 | `[ ]`  |                                                                                                                                                                                                          |
| **7. Reports**            |                                                                                                                                                                        |        |                                                                                                                                                                                                          |
|                           | "Select what to generate" dropdown/options                                                                                                                             | `[ ]`  |                                                                                                                                                                                                          |
|                           | Offense Level filter (no offense, first, second, third and up, all)                                                                                                    | `[ ]`  |                                                                                                                                                                                                          |
|                           | Statistics Vehicles/Driver filter (no offense, first, second, third and up, all)                                                                                       | `[ ]`  |                                                                                                                                                                                                          |
|                           | PDF Print functionality for selected report                                                                                                                            | `[ ]`  |                                                                                                                                                                                                          |
|                           | Report Table Structure (No., Driver/Operator, Plate Number, Offense Level, Last Offense Paid, Paid Status) with Header                                                 | `[ ]`  |                                                                                                                                                                                                          |
|                           | Backend: Schema, Resolvers, Services for Report data aggregation & generation                                                                                          | `[ ]`  |                                                                                                                                                                                                          |

---

**Additional Notes for AI Agent:**

- Prioritize clear and intuitive UI. Assume users may not be familiar with modern web applications.
- Ensure all form inputs have appropriate validation (client-side and server-side).
- Maintain consistency in naming conventions and code style.
- Provide user feedback for actions (e.g., success/error messages).
- GraphQL queries and mutations should be designed to fetch/mutate only the necessary data.
- For PDF generation, consider using a library like `jspdf` or `react-pdf` on the client-side, or a server-side PDF generation library if complex templates are needed.

Good luck with the development!
